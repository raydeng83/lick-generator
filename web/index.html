<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jazz Lick Generator â€¢ Prototype</title>
    <link rel="stylesheet" href="./style.css" />
    <!-- VexFlow CDN (UMD with Vex.Flow namespace) -->
    <script src="https://unpkg.com/vexflow@1.2.93/releases/vexflow-min.js"></script>
    <!-- Tone.js CDN -->
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
  </head>
  <body>
    <div class="app">
      <header>
        <h1>Jazz Lick Generator</h1>
        <p class="sub">Rule-based prototype with notation and audio</p>
      </header>

      <section class="controls">
        <div class="field">
          <label>Mode</label>
          <div class="mode-toggle">
            <label class="inline"><input type="radio" name="mode" value="progression" id="modeProgression" checked /> Progression</label>
            <label class="inline"><input type="radio" name="mode" value="rhythm" id="modeRhythm" /> Rhythm Exercise</label>
          </div>
        </div>

        <!-- Progression Mode -->
        <div id="progressionControls">
          <div class="field">
            <label for="progression">Chord Progression</label>
            <textarea id="progression" rows="3" placeholder="Dm7 | G7 | Cmaj7"></textarea>
            <div class="hint">Use `|` to separate bars. Space-separated chords split the bar equally.</div>
          </div>
        </div>

        <!-- Rhythm Exercise Mode -->
        <div id="rhythmControls" style="display: none;">
          <div class="row">
            <div class="field">
              <label for="exerciseChord">Chord</label>
              <input id="exerciseChord" type="text" placeholder="Cmaj7" value="Cmaj7" />
            </div>
            <div class="field">
              <label for="numRests">Number of Rests</label>
              <select id="numRests">
                <option value="0">0 (Original)</option>
                <option value="1">1 rest (8 patterns)</option>
                <option value="2">2 rests (28 patterns)</option>
                <option value="3" selected>3 rests (56 patterns)</option>
                <option value="4">4 rests (70 patterns)</option>
                <option value="5">5 rests (56 patterns)</option>
                <option value="6">6 rests (28 patterns)</option>
                <option value="7">7 rests (8 patterns)</option>
                <option value="8">8 rests (1 pattern)</option>
              </select>
            </div>
            <div class="field">
              <label for="numMeasures">Number of Measures</label>
              <input id="numMeasures" type="number" min="1" max="100" value="10" />
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button id="generateExercises">Generate Exercises</button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="tempo">Tempo (BPM)</label>
            <input id="tempo" type="number" min="40" max="300" step="1" value="100" />
          </div>
          <div class="field">
            <label for="instrument">Instrument</label>
            <select id="instrument">
              <option value="piano">Piano</option>
              <option value="synth">Synth</option>
            </select>
          </div>
          <div class="field">
            <label for="scaleStrategy">Scale Strategy</label>
            <select id="scaleStrategy">
              <option value="default">Default (Most Common)</option>
              <option value="varied">Varied (Random Choice)</option>
              <option value="exotic">Exotic (Outside Choices)</option>
              <option value="per-family-varied">Per-Family Random (Rule 3)</option>
            </select>
          </div>
          <div class="field">
            <label for="deviceStrategy">Device Strategy</label>
            <select id="deviceStrategy">
              <option value="disabled">Disabled (Rules 1-4)</option>
              <option value="varied">Varied Devices</option>
              <option value="cell-focused">Cell-Focused (Rule 5)</option>
              <option value="arpeggio-focused">Arpeggio-Focused</option>
              <option value="scale-focused">Scale-Focused</option>
              <option value="arpeggio-scale-mix">Arpeggio + Scale Mix</option>
              <option value="neighbor-enclosure" selected>Neighbor Tone & Enclosure</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="swing">Swing</label>
            <input id="swing" type="range" min="0" max="1" step="0.1" value="0" />
            <span id="swingValue">0% (Straight)</span>
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <label class="inline"><input id="metronome" type="checkbox" /> Metronome</label>
            <label class="inline"><input id="chords" type="checkbox" checked /> Chords</label>
            <label class="inline"><input id="showRests" type="checkbox" /> Show Rests</label>
          </div>
          <div class="spacer"></div>
          <div class="buttons">
            <button id="generate">Generate</button>
            <button id="regenerateRests" style="display: none;">New Rests</button>
            <button id="diceIt" style="display: none;">Dice it</button>
            <button id="firstPattern" style="display: none;">First Pattern</button>
            <button id="prevPattern" style="display: none;">Previous Pattern</button>
            <button id="nextPattern" style="display: none;">Next Pattern</button>
            <span id="patternInfo" style="display: none; margin: 0 8px; color: var(--muted); font-size: 13px;"></span>
            <button id="resetOriginal" style="display: none;">Reset to Original</button>
            <button id="play">Play</button>
            <button id="stop">Stop</button>
          </div>
        </div>
      </section>

      <section class="notation">
        <div class="legend">
          <span class="legend-item"><span class="color-box chord-tone"></span> Chord Tone</span>
          <span class="legend-item"><span class="color-box scale-tone"></span> Scale Tone</span>
          <span class="legend-item"><span class="color-box chromatic"></span> Chromatic</span>
          <label class="inline" style="margin-left: 20px;"><input id="coloredNotes" type="checkbox" checked /> Colored Notes</label>
        </div>
        <div id="notation"></div>
      </section>

      <section class="json">
        <div class="row">
          <h3>State</h3>
          <button id="copyState" class="small">Copy JSON</button>
        </div>
        <pre id="state"></pre>
      </section>

      <footer>
        <span id="status">Ready.</span>
      </footer>
    </div>

    <script src="./schema.js"></script>
    <script src="./scales.js"></script>
    <script src="./melodic-cells.js"></script>
    <script src="./devices.js"></script>
    <script src="./variations.js"></script>
    <script src="./devices-new.js"></script>
    <script src="./generator.js"></script>
    <script src="./notate.js"></script>
    <script src="./audio.js"></script>
    <script src="./app.js"></script>
  </body>
  </html>
